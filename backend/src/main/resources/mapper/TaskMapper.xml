<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wooreal.gravitygather.mapper.TaskMapper">

    <insert id="addTask">
        INSERT INTO TASKS(
            TITLE,
            CATEGORY_CODE,
            CONTENT,
            IS_ALL_DAY,
            IS_DELETE,
            USER_SEQ,
            START_DATE,
            END_DATE,
            START_TIME,
            END_TIME,
            CREATED_AT,
            UPDATED_AT
        ) VALUES (
            #{title},
            #{category_code},
            #{content},
            #{is_all_day},
            false,
            #{user_seq},
            FROM_UNIXTIME(${start_date}),
            FROM_UNIXTIME(${end_date}),
            FROM_UNIXTIME(${start_time}),
            FROM_UNIXTIME(${end_time}),
            now(),
            now()
        )
        <selectKey keyProperty="seq" resultType="Integer" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <insert id="addTaskShare">
        INSERT INTO TASK_SHARE(
            TASK_SEQ,
            USER_SEQ,
            SHARE_DATE,
            CAPTION
        ) VALUES (
            <foreach item="item" index="index" collection="shared_user_seq" separator=",">
                (
                     #{seq},
                     #{item},
                     now(),
                     #{caption}
                )
            </foreach>
        )
    </insert>

</mapper>
